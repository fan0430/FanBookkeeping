# 變更日誌 (Changelog)

## [1.1.1] - 2025-01-XX

### 🔧 重要變更

#### 條碼解析邏輯優化
- **變更描述**: 修改條碼解析邏輯，商品必須先在商品管理中登入才能進行掃描
- **之前行為**: 支援寬鬆解析，未知商品仍可正常解析並繼續後續流程
- **現在行為**: 嚴格檢查商品登入狀態，未登入商品會顯示錯誤並停止後續處理
- **錯誤訊息**: 新增「商品未登入：{類別}-{產品代碼}，請先在商品管理中新增此商品」
- **影響範圍**: POS 系統條碼掃描功能
- **技術實現**: 
  - 修改 `parseBarcode()` 函數邏輯
  - 移除 `isProductRegistered` 屬性
  - 統一錯誤處理方式

### 📝 文件更新
- 更新 `README.md` 中的條碼格式說明
- 更新 `QUICK_FIX_GUIDE.md` 中的故障排除指南
- 更新 `TROUBLESHOOTING_GUIDE.md` 中的問題解決方案

---

## [1.1.0] - 2025-07-25

### 🆕 新增功能

#### 1. 預設頁面設定系統
- **功能描述**: 允許用戶自訂應用程式啟動時顯示的頁面
- **選項**: 主選擇頁面、帳本選擇、POS 系統
- **位置**: 設定頁面 → 應用程式 → 預設頁面
- **技術實現**: 
  - 新增 `AppSettings` 介面
  - 實作 `updateAppSettings` 和 `loadAppSettings` 函數
  - 使用 AsyncStorage 持久化儲存設定
  - 在 `App.tsx` 中自動載入預設頁面

#### 2. 環境檢測系統
- **功能描述**: 自動檢測當前環境模式並提供詳細資訊
- **檢測項目**: Debug/Release 模式、平台、版本、模擬器狀態
- **技術實現**:
  - 新增 `isReleaseMode()` 和 `isDebugMode()` 函數
  - 新增 `getEnvironmentInfo()` 函數
  - 新增 `logEnvironmentInfo()` 函數
  - 在 POS 系統中整合環境檢測功能

#### 3. 智能 API 配置系統
- **功能描述**: 根據環境自動調整 API 請求配置
- **Release 模式特性**:
  - 自動添加安全性和相容性 headers
  - 禁用快取確保資料即時性
  - 30 秒超時保護
  - 詳細的 API 活動日誌
- **技術實現**:
  - 新增 `apiConfig.ts` 檔案
  - 實作 `getGoogleApiConfig()` 函數
  - 實作 `createGoogleApiClient()` 函數
  - 添加請求/回應攔截器

#### 4. 增強的 Google 整合診斷
- **功能描述**: 內建診斷工具和快速修復功能
- **診斷項目**:
  - Google 登入狀態檢測
  - 權杖有效性檢查
  - API 連線測試
  - 環境資訊顯示
- **技術實現**:
  - 擴展 `googleAuthTest.ts` 功能
  - 新增 `testApiConnection()` 函數
  - 新增 `logApiEnvironmentInfo()` 函數
  - 在 POS 系統中整合診斷介面

#### 5. 改進的設定系統
- **功能描述**: 持久化設定儲存和即時更新
- **特性**:
  - 設定自動保存到 AsyncStorage
  - 應用程式啟動時自動載入設定
  - 設定變更立即生效
  - 智能預設值管理

### 🔧 技術改進

#### 1. 檔案結構優化
- 重新組織 `utils/` 目錄結構
- 新增檔案註解說明
- 改善程式碼可讀性

#### 2. 錯誤處理增強
- 完善的 API 錯誤處理
- 詳細的錯誤日誌記錄
- 用戶友善的錯誤訊息

#### 3. 效能優化
- Release 模式下的 API 配置優化
- 快取控制策略
- 超時保護機制

### 📝 文件更新

#### 1. 新增文件
- `CHANGELOG.md` - 變更日誌
- `RELEASE_MODE_API_GUIDE.md` - Release 模式 API 配置指南

#### 2. 更新文件
- `README.md` - 加入新功能說明
- `GOOGLE_INTEGRATION_SUMMARY.md` - 更新功能總結
- `QUICK_FIX_GUIDE.md` - 加入新功能故障排除

### 🐛 修復問題

#### 1. Google 登入相關
- 改善 Google 登入錯誤處理
- 修復權杖管理問題
- 增強網路連線檢測

#### 2. 設定系統
- 修復設定載入時機問題
- 改善預設值處理邏輯
- 修復設定更新同步問題

### 🔄 向後相容性

- 所有新功能都保持向後相容
- 現有設定會自動遷移到新系統
- 預設行為保持不變

### 📱 使用者體驗改善

#### 1. 介面優化
- 新增預設頁面選擇介面
- 改善設定頁面佈局
- 新增診斷工具介面

#### 2. 操作流程
- 簡化預設頁面設定流程
- 改善環境檢測操作
- 優化診斷工具使用體驗

### 🧪 測試

#### 1. 功能測試
- ✅ 預設頁面設定功能測試
- ✅ 環境檢測功能測試
- ✅ API 配置功能測試
- ✅ Google 診斷功能測試

#### 2. 相容性測試
- ✅ Debug 模式測試
- ✅ Release 模式測試
- ✅ Android 平台測試
- ✅ iOS 平台測試

### 📋 已知問題

- 無重大已知問題
- 所有功能已通過基本測試

### 🚀 部署注意事項

#### 1. 建置要求
- React Native 0.75.2
- Node.js >= 18
- 最新版本的依賴套件

#### 2. 環境設定
- 確保 Google Cloud Console 設定正確
- 更新 SHA-1 憑證指紋（如需要）
- 確認 API 權限設定

#### 3. 測試建議
- 在真機上測試所有新功能
- 特別測試 Release 模式下的 API 功能
- 驗證預設頁面設定功能

---

## [1.0.0] - 2025-07-24

### 🎉 初始版本發布

#### 核心功能
- 基本記帳功能
- POS 系統
- 條碼掃描
- Google 整合
- 產品管理

#### 技術架構
- React Native 0.75.2
- TypeScript
- Google Sign-In
- Google Sheets API

---

**維護者**: FanBookkeeping 開發團隊  
**最後更新**: 2025年7月25日  
**版本**: 1.1.0 